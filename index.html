<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Top-Secret</title>
  <meta name="description" content="Top-Secret: G√ºvenli ve modern sohbet, √∂zel chat ve oyun platformu.">
  <meta property="og:title" content="Top-Secret" />
  <meta property="og:description" content="G√ºvenli ve modern sohbet, √∂zel chat ve oyun platformu." />
  <meta property="og:type" content="website" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0c10 0%, #1a2340 100%);
      color: #f5f5f7;
      font-family: 'Inter', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow-x: hidden;
    }

    body.light-mode {
      background: linear-gradient(135deg, #f5f5f7 0%, #e8eaf6 100%);
      color: #1a2340;
    }

    #wave-bg {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 220px;
      z-index: 0;
      pointer-events: none;
    }

    .auth-card, .chat-card, .game-card {
      background: linear-gradient(135deg, #1a2340 80%, #232136 100%);
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(10, 12, 16, 0.3), 0 1px 0 rgba(35, 39, 43, 0.1);
      padding: 2.5rem 2rem;
      width: 100%;
      max-width: 400px;
      position: relative;
      z-index: 1;
      animation: cardFadeIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      backdrop-filter: blur(10px);
    }

    body.light-mode .auth-card,
    body.light-mode .chat-card,
    body.light-mode .game-card {
      background: linear-gradient(135deg, #ffffff 80%, #f5f5f7 100%);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    @keyframes cardFadeIn {
      0% { opacity: 0; transform: translateY(-40px) scale(0.95); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .auth-title, .chat-title {
      font-size: 2rem;
      font-weight: 700;
      color: #ff9800;
      text-align: center;
      margin-bottom: 1.5rem;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
    }

    .auth-form, .chat-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .auth-form input, .chat-form input {
      background: #10131a;
      color: #f5f5f7;
      border: 2px solid #3a4a7c;
      border-radius: 12px;
      font-size: 1rem;
      padding: 0.8rem 1rem;
      transition: all 0.3s;
      outline: none;
    }

    body.light-mode .auth-form input,
    body.light-mode .chat-form input {
      background: #ffffff;
      color: #1a2340;
      border-color: #7c3aed;
    }

    .auth-form input:focus, .chat-form input:focus {
      box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.3);
      border-color: #ff9800;
    }

    .btn {
      background: linear-gradient(90deg, #7c3aed 0%, #ff9800 100%);
      border: none;
      color: #fff;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: 0.3px;
      padding: 0.8rem 1.2rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 152, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-switch {
      background: none;
      border: none;
      color: #7c3aed;
      font-weight: 600;
      margin-top: 0.5rem;
      cursor: pointer;
      text-align: center;
      font-size: 0.95rem;
      text-decoration: underline;
      transition: color 0.2s;
    }

    body.light-mode .auth-switch {
      color: #5e35b1;
    }

    .auth-switch:hover { color: #ff9800; }

    .message-box {
      color: #ff6b6b;
      font-size: 0.95rem;
      margin-top: 0.5rem;
      text-align: center;
      min-height: 1.2rem;
    }

    .message-box.success {
      color: #43ea7b;
    }

    .chat-messages {
      height: 400px;
      overflow-y: auto;
      background: #10131a;
      border-radius: 12px;
      padding: 1rem;
      font-size: 1rem;
      color: #fff;
      margin-bottom: 1rem;
      animation: fadeIn 0.5s;
      scroll-behavior: smooth;
    }

    body.light-mode .chat-messages {
      background: #f5f5f7;
      color: #1a2340;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: #7c3aed;
      border-radius: 3px;
    }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    .chat-message {
      margin-bottom: 0.8rem;
      word-break: break-word;
      animation: slideIn 0.3s;
      padding: 0.5rem;
      border-radius: 8px;
      background: rgba(124, 58, 237, 0.1);
    }

    @keyframes slideIn {
      0% { opacity: 0; transform: translateX(-10px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    .chat-user {
      color: #ff9800;
      font-weight: 600;
      margin-right: 0.5rem;
    }

    .chat-text {
      color: #fff;
    }

    body.light-mode .chat-text {
      color: #1a2340;
    }

    .fab {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #7c3aed 0%, #ff9800 100%);
      box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1.5rem;
      color: #fff;
    }

    .fab:hover {
      transform: scale(1.1) translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 152, 0, 0.4);
    }

    .fab-container {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .header-buttons {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 2000;
      display: flex;
      gap: 0.5rem;
    }

    .header-btn {
      padding: 0.5rem 0.8rem;
      border-radius: 8px;
      border: none;
      background: rgba(35, 33, 54, 0.8);
      backdrop-filter: blur(10px);
      color: #ff9800;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
    }

    .header-btn:hover {
      transform: translateY(-2px);
      background: rgba(124, 58, 237, 0.8);
    }

    .logo {
      text-align: center;
      padding: 2rem 0 1rem 0;
      position: relative;
      z-index: 1;
    }

    .logo-text {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ff9800 0%, #7c3aed 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 2px;
      text-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }

    .welcome-msg {
      margin-top: 0.5rem;
      font-size: 1.1rem;
      color: #43ea7b;
      font-weight: 600;
    }

    .toast {
      position: fixed;
      top: 24px;
      right: 24px;
      background: rgba(35, 33, 54, 0.95);
      backdrop-filter: blur(10px);
      color: #ff9800;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
      font-weight: 600;
      z-index: 5000;
      animation: toastIn 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    @keyframes toastIn {
      0% { opacity: 0; transform: translateY(-20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .modal-bg {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(10, 12, 16, 0.8);
      backdrop-filter: blur(5px);
      z-index: 3000;
    }

    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #1a2340 80%, #232136 100%);
      border-radius: 20px;
      padding: 2rem;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      z-index: 3001;
      box-shadow: 0 8px 32px rgba(124, 58, 237, 0.4);
      animation: modalPopIn 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    body.light-mode .modal {
      background: linear-gradient(135deg, #ffffff 80%, #f5f5f7 100%);
    }

    @keyframes modalPopIn {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
      100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    .modal h2 {
      color: #ff9800;
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .modal p, .modal ul {
      color: #f5f5f7;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    body.light-mode .modal p,
    body.light-mode .modal ul {
      color: #1a2340;
    }

    .online-user {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      margin-bottom: 0.3rem;
      background: rgba(124, 58, 237, 0.1);
      border-radius: 8px;
      animation: slideIn 0.3s;
    }

    .online-indicator {
      width: 8px;
      height: 8px;
      background: #43ea7b;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .game-board {
      display: grid;
      grid-template-columns: repeat(3, 80px);
      grid-template-rows: repeat(3, 80px);
      gap: 10px;
      margin: 1.5rem auto;
      justify-content: center;
    }

    .game-cell {
      width: 80px;
      height: 80px;
      font-size: 2rem;
      font-weight: 700;
      border-radius: 12px;
      background: #181a1b;
      border: 2px solid #7c3aed;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }

    .game-cell:hover:not(:disabled) {
      background: rgba(124, 58, 237, 0.2);
      transform: scale(1.05);
    }

    .game-cell:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .game-cell.x {
      color: #43ea7b;
    }

    .game-cell.o {
      color: #ff9800;
    }

    footer {
      width: 100%;
      text-align: center;
      padding: 1.5rem;
      background: rgba(35, 33, 54, 0.5);
      backdrop-filter: blur(10px);
      color: #f5f5f7;
      font-size: 0.95rem;
      margin-top: auto;
      border-top: 1px solid rgba(124, 58, 237, 0.2);
    }

    body.light-mode footer {
      background: rgba(255, 255, 255, 0.8);
      color: #1a2340;
    }

    footer a {
      color: #ff9800;
      text-decoration: none;
      transition: color 0.2s;
    }

    footer a:hover {
      color: #7c3aed;
      text-decoration: underline;
    }

    .room-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: rgba(124, 58, 237, 0.1);
      border-radius: 10px;
      animation: slideIn 0.3s;
    }

    .room-name {
      font-weight: 600;
      color: #fff;
    }

    body.light-mode .room-name {
      color: #1a2340;
    }

    @media (max-width: 600px) {
      .auth-card, .chat-card, .game-card {
        max-width: 95vw;
        padding: 1.5rem 1rem;
        border-radius: 16px;
      }
      
      .auth-title, .chat-title {
        font-size: 1.5rem;
      }
      
      .logo-text {
        font-size: 2rem;
      }
      
      .chat-messages {
        height: 300px;
      }
      
      .game-board {
        grid-template-columns: repeat(3, 70px);
        grid-template-rows: repeat(3, 70px);
      }
      
      .game-cell {
        width: 70px;
        height: 70px;
        font-size: 1.8rem;
      }

      .fab-container {
        right: 16px;
        bottom: 16px;
      }

      .fab {
        width: 48px;
        height: 48px;
        font-size: 1.3rem;
      }
    }

    .verify-modal {
      text-align: center;
    }

    .verify-modal input {
      font-size: 1.5rem;
      text-align: center;
      letter-spacing: 0.5em;
      padding: 0.8rem 1rem;
      border-radius: 10px;
      border: 2px solid #7c3aed;
      width: 90%;
      margin: 1rem auto;
      background: #181a1b;
      color: #fff;
    }

    body.light-mode .verify-modal input {
      background: #ffffff;
      color: #1a2340;
    }

    .verify-timer {
      font-size: 1.5rem;
      color: #ff9800;
      font-weight: 700;
      margin: 1rem 0;
    }

    .cooldown-warning {
      color: #ff9800;
      font-weight: 600;
      text-align: center;
      margin: 0.5rem 0;
      min-height: 1.2rem;
      font-size: 0.95rem;
    }

    .user-info-panel {
      background: rgba(124, 58, 237, 0.1);
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 1rem;
    }

    .user-info-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
      color: #f5f5f7;
    }

    body.light-mode .user-info-row {
      color: #1a2340;
    }

    .user-info-label {
      font-weight: 600;
      color: #ff9800;
      min-width: 100px;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <svg id="wave-bg" viewBox="0 0 1440 220" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill="#232136" fill-opacity="0.5" d="M0,160 C480,220 960,100 1440,160 L1440,0 L0,0 Z"></path>
  </svg>

  <div class="header-buttons">
    <button id="theme-toggle-btn" class="header-btn" title="Tema Deƒüi≈ütir">üåô</button>
    <button id="lang-toggle-btn" class="header-btn" title="Dil Deƒüi≈ütir">EN</button>
  </div>

  <div class="logo">
    <div class="logo-text">Top-Secret</div>
    <div id="welcome-msg" class="welcome-msg hidden"></div>
  </div>

  <div id="toast-container" style="position: fixed; top: 90px; right: 24px; z-index: 5000; display: flex; flex-direction: column; gap: 0.5rem;"></div>

  <div class="fab-container hidden" id="fab-container">
    <button class="fab" id="scroll-top-btn" title="Yukarƒ± √áƒ±k">‚Üë</button>
    <button class="fab" id="special-chat-btn" title="√ñzel Chat">üí¨</button>
    <button class="fab" id="user-info-btn" title="Hesap Bilgileri">üë§</button>
  </div>

  <!-- Auth Container -->
  <div class="auth-card" id="auth-container">
    <div class="auth-title" id="form-title">Giri≈ü Yap</div>
    
    <form class="auth-form" id="login-form" autocomplete="off">
      <input type="email" id="login-email" placeholder="E-posta" required />
      <input type="password" id="login-password" placeholder="≈ûifre" required minlength="6" />
      <button type="submit" class="btn">Giri≈ü Yap</button>
      <div class="message-box" id="login-error"></div>
      <button type="button" class="auth-switch" id="show-signup">Hesabƒ±n yok mu? Kayƒ±t Ol</button>
    </form>

    <form class="auth-form hidden" id="signup-form" autocomplete="off">
      <input type="email" id="signup-email" placeholder="E-posta" required />
      <input type="password" id="signup-password" placeholder="≈ûifre (min 6 karakter)" required minlength="6" />
      <button type="submit" class="btn">Kayƒ±t Ol</button>
      <div class="message-box" id="signup-error"></div>
      <div class="message-box success" id="signup-success"></div>
      <button type="button" class="auth-switch" id="show-login">Zaten hesabƒ±n var mƒ±? Giri≈ü Yap</button>
    </form>
  </div>

  <!-- Chat Container -->
  <div id="chat-container" class="hidden" style="display: flex; gap: 1.5rem; flex-wrap: wrap; justify-content: center; padding: 0 1rem;">
    <div class="chat-card" style="max-width: 500px;">
      <div class="chat-title">Sohbet</div>
      <div id="chat-messages" class="chat-messages"></div>
      <div class="cooldown-warning" id="cooldown-warning"></div>
      <form id="chat-form" class="chat-form" autocomplete="off">
        <input id="chat-input" type="text" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..." maxlength="300" required />
        <button type="submit" class="btn">G√∂nder</button>
      </form>
      <button id="xox-btn" class="btn" style="margin-top: 1rem;">X O X Oyna</button>
      <button id="logout-btn" class="btn" style="margin-top: 0.5rem; background: linear-gradient(90deg, #232136 0%, #1a2340 100%);">√áƒ±kƒ±≈ü Yap</button>
    </div>

    <div class="chat-card" style="max-width: 350px;">
      <div class="chat-title">Online Kullanƒ±cƒ±lar</div>
      <div id="online-users-list" class="chat-messages" style="height: 300px;"></div>
    </div>
  </div>

  <!-- XOX Lobby -->
  <div id="xox-lobby" class="hidden" style="width: 100%; max-width: 500px; padding: 0 1rem;">
    <div class="game-card">
      <div class="auth-title">XOX Odalarƒ±</div>
      <form id="create-room-form" class="auth-form" style="margin-bottom: 1.5rem;">
        <input type="text" id="room-name-input" placeholder="Oda adƒ± (√∂rn: Oda-1)" required minlength="2" maxlength="20" />
        <button type="submit" class="btn">Oda Olu≈ütur</button>
      </form>
      <div id="room-list"></div>
      <button id="refresh-rooms-btn" class="btn" style="margin-top: 1rem;">Odalarƒ± Yenile</button>
      <button id="back-to-chat-btn" class="btn" style="margin-top: 0.5rem; background: linear-gradient(90deg, #232136 0%, #1a2340 100%);">Sohbete D√∂n</button>
    </div>
  </div>

  <!-- Modals -->
  <div id="modal-bg" class="modal-bg"></div>
  <div id="modal" class="modal"></div>

  <footer>
    ¬© 2024 Top-Secret | G√ºvenli Sohbet ve Oyun Platformu
    ¬∑ <a href="#" id="about-link">Hakkƒ±nda</a>
    ¬∑ <a href="#" id="terms-link">Kullanƒ±m Ko≈üullarƒ±</a>
    ¬∑ <a href="#" id="shortcuts-link">Kƒ±sayollar</a>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  
  <script>
    emailjs.init("Gy90aa1c2OepdW7pi");

    const firebaseConfig = {
      apiKey: "AIzaSyD39X1qF5C39TYzPcOhmo5lJVlRfU-dRvc",
      authDomain: "top-secret-a5628.firebaseapp.com",
      projectId: "top-secret-a5628",
      storageBucket: "top-secret-a5628.appspot.com",
      messagingSenderId: "854924115836",
      appId: "1:854924115836:web:be1a865f48e7a868376ef9",
      measurementId: "G-36WWQ06YRK"
    };
    
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Utility Functions
    function showToast(msg) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = msg;
      container.appendChild(toast);
      setTimeout(() => toast.style.opacity = '0', 2500);
      setTimeout(() => toast.remove(), 3000);
    }

    function showModal(title, content, buttons = []) {
      const bg = document.getElementById('modal-bg');
      const modal = document.getElementById('modal');
      
      let html = `<h2>${title}</h2><div>${content}</div><div style="display: flex; gap: 1rem; margin-top: 1.5rem; justify-content: center;">`;
      
      buttons.forEach(btn => {
        html += `<button class="btn" style="${btn.style || ''}" onclick="${btn.action}">${btn.text}</button>`;
      });
      
      html += `</div>`;
      modal.innerHTML = html;
      bg.style.display = 'block';
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('modal-bg').style.display = 'none';
      document.getElementById('modal').style.display = 'none';
      document.body.style.overflow = '';
    }

    // Theme Toggle
    let darkMode = true;
    document.getElementById('theme-toggle-btn').onclick = function() {
      darkMode = !darkMode;
      document.body.classList.toggle('light-mode');
      this.textContent = darkMode ? 'üåô' : '‚òÄÔ∏è';
      showToast(darkMode ? 'Karanlƒ±k mod aktif' : 'A√ßƒ±k mod aktif');
    };

    // Language Toggle
    let lang = 'TR';
    document.getElementById('lang-toggle-btn').onclick = function() {
      lang = lang === 'TR' ? 'EN' : 'TR';
      this.textContent = lang === 'TR' ? 'EN' : 'TR';
      showToast(lang === 'TR' ? 'Dil: T√ºrk√ße' : 'Language: English');
    };

    // Auth Form Toggle
    document.getElementById('show-signup').onclick = function() {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('signup-form').classList.remove('hidden');
      document.getElementById('form-title').textContent = 'Kayƒ±t Ol';
    };

    document.getElementById('show-login').onclick = function() {
      document.getElementById('signup-form').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('form-title').textContent = 'Giri≈ü Yap';
    };

    // Login
    document.getElementById('login-form').onsubmit = function(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');
      
      errorDiv.textContent = '';
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          errorDiv.className = 'message-box success';
          errorDiv.textContent = 'Giri≈ü ba≈üarƒ±lƒ±!';
          setTimeout(() => {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('chat-container').classList.remove('hidden');
            document.getElementById('fab-container').classList.remove('hidden');
          }, 500);
        })
        .catch(err => {
          errorDiv.className = 'message-box';
          errorDiv.textContent = 'Giri≈ü ba≈üarƒ±sƒ±z: ' + err.message;
        });
    };

    // Signup with Email Verification
    document.getElementById('signup-form').onsubmit = function(e) {
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const errorDiv = document.getElementById('signup-error');
      const successDiv = document.getElementById('signup-success');
      
      errorDiv.textContent = '';
      successDiv.textContent = '';
      
      const code = Math.floor(100000 + Math.random() * 900000);
      
      emailjs.send("service_a1d2neu", "template_3r4mr8b", {
        to_email: email,
        code: code
      })
      .then(() => showVerificationModal(code, email, password))
      .catch(err => {
        errorDiv.textContent = "Kod g√∂nderilemedi: " + err.text;
      });
    };

    function showVerificationModal(expectedCode, email, password) {
      let timer = 30;
      const content = `
        <div class="verify-modal">
          <p>Mail adresinize g√∂nderilen <strong style="color:#ff9800;">6 haneli kodu</strong> girin:</p>
          <input id="verify-code-input" type="text" maxlength="6" pattern="[0-9]{6}" autofocus />
          <div class="verify-timer" id="verify-timer">30</div>
          <div class="message-box" id="verify-error"></div>
        </div>
      `;
      
      showModal('E-posta Doƒürulama', content, [
        { text: 'Doƒürula', action: 'verifyCode()' },
        { text: 'ƒ∞ptal', action: 'closeModal()', style: 'background: #23272b; color: #ff9800;' }
      ]);
      
      const interval = setInterval(() => {
        timer--;
        const timerEl = document.getElementById('verify-timer');
        if (timerEl) timerEl.textContent = timer;
        
        if (timer <= 0) {
          clearInterval(interval);
          const errorEl = document.getElementById('verify-error');
          if (errorEl) {
            errorEl.textContent = 'S√ºre doldu. L√ºtfen tekrar kayƒ±t olun.';
            document.querySelector('#modal button').disabled = true;
          }
        }
      }, 1000);
      
      window.verifyCode = function() {
        const input = document.getElementById('verify-code-input');
        const errorEl = document.getElementById('verify-error');
        
        if (input.value.trim() === expectedCode.toString()) {
          clearInterval(interval);
          closeModal();
          
          auth.createUserWithEmailAndPassword(email, password)
            .then(() => {
              document.getElementById('signup-success').textContent = 'Kayƒ±t ba≈üarƒ±lƒ±! ≈ûimdi giri≈ü yapabilirsiniz.';
              setTimeout(() => document.getElementById('show-login').click(), 1500);
            })
            .catch(err => {
              document.getElementById('signup-error').textContent = err.message;
            });
        } else {
          errorEl.textContent = 'Kod yanlƒ±≈ü!';
        }
      };
    }

    // Auth State Observer
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('auth-container').classList.add('hidden');
        document.getElementById('chat-container').classList.remove('hidden');
        document.getElementById('fab-container').classList.remove('hidden');
        
        const welcomeMsg = document.getElementById('welcome-msg');
        welcomeMsg.textContent = `Ho≈ügeldin, ${user.email.split('@')[0]}!`;
        welcomeMsg.classList.remove('hidden');
        
        setOnlineUser();
      } else {
        document.getElementById('chat-container').classList.add('hidden');
        document.getElementById('fab-container').classList.add('hidden');
        document.getElementById('auth-container').classList.remove('hidden');
        document.getElementById('welcome-msg').classList.add('hidden');
        document.getElementById('xox-lobby').classList.add('hidden');
      }
    });

    // Chat System
    let username = localStorage.getItem('chat-username');
    let chatCooldown = false;
    let messageCount = 0;

    function ensureUsername() {
      if (!username) {
        username = prompt('Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin:');
        if (username && username.trim()) {
          localStorage.setItem('chat-username', username.trim());
        } else {
          ensureUsername();
        }
      }
    }

    document.getElementById('chat-form').onsubmit = function(e) {
      e.preventDefault();
      if (chatCooldown) return;
      
      ensureUsername();
      const input = document.getElementById('chat-input');
      const text = input.value.trim();
      
      if (!text) return;
      
      if (text === '/clear') {
        db.ref('messages').remove().then(() => {
          document.getElementById('chat-messages').innerHTML = '';
          showToast('Sohbet temizlendi!');
        });
      } else {
        db.ref('messages').push({
          user: username,
          text: text,
          time: Date.now()
        });
      }
      
      input.value = '';
      messageCount++;
      
      if (messageCount >= 3) {
        chatCooldown = true;
        input.disabled = true;
        this.querySelector('button[type="submit"]').disabled = true;
        
        let remaining = 2;
        const warningDiv = document.getElementById('cooldown-warning');
        warningDiv.textContent = `${remaining} saniye bekleyin...`;
        
        const cooldownInterval = setInterval(() => {
          remaining--;
          if (remaining > 0) {
            warningDiv.textContent = `${remaining} saniye bekleyin...`;
          } else {
            clearInterval(cooldownInterval);
            chatCooldown = false;
            input.disabled = false;
            this.querySelector('button[type="submit"]').disabled = false;
            warningDiv.textContent = '';
            messageCount = 0;
          }
        }, 1000);
      }
    };

    // Listen to messages
    db.ref('messages').limitToLast(50).on('child_added', snapshot => {
      const msg = snapshot.val();
      const msgDiv = document.createElement('div');
      msgDiv.className = 'chat-message';
      msgDiv.innerHTML = `<span class="chat-user">${msg.user}:</span> <span class="chat-text">${msg.text}</span>`;
      
      const container = document.getElementById('chat-messages');
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    });

    // Online Users System
    let onlineUserKey = null;

    function setOnlineUser() {
      ensureUsername();
      
      db.ref('onlineUsers').orderByChild('username').equalTo(username).once('value', snapshot => {
        snapshot.forEach(child => child.ref.remove());
        
        const userRef = db.ref('onlineUsers').push({
          username: username,
          time: Date.now()
        });
        
        onlineUserKey = userRef.key;
        userRef.onDisconnect().remove();
      });
    }

    function removeOnlineUser() {
      if (onlineUserKey) {
        db.ref('onlineUsers/' + onlineUserKey).remove();
        onlineUserKey = null;
      }
    }

    db.ref('onlineUsers').on('value', snapshot => {
      const users = snapshot.val() || {};
      const container = document.getElementById('online-users-list');
      container.innerHTML = '';
      
      const userNames = Object.values(users).map(u => u.username);
      
      if (userNames.length === 0) {
        container.innerHTML = '<div style="color:#ff9800;text-align:center;">≈ûu anda kimse online deƒüil</div>';
      } else {
        userNames.forEach(name => {
          const div = document.createElement('div');
          div.className = 'online-user';
          div.innerHTML = `<div class="online-indicator"></div><span style="font-weight:600;">${name}</span>`;
          container.appendChild(div);
        });
      }
    });

    // Logout
    document.getElementById('logout-btn').onclick = function() {
      removeOnlineUser();
      localStorage.removeItem('chat-username');
      auth.signOut();
    };

    // XOX Game System
    document.getElementById('xox-btn').onclick = function() {
      document.getElementById('chat-container').classList.add('hidden');
      document.getElementById('xox-lobby').classList.remove('hidden');
      loadRooms();
    };

    document.getElementById('back-to-chat-btn').onclick = function() {
      document.getElementById('xox-lobby').classList.add('hidden');
      document.getElementById('chat-container').classList.remove('hidden');
    };

    document.getElementById('create-room-form').onsubmit = function(e) {
      e.preventDefault();
      const roomName = document.getElementById('room-name-input').value.trim();
      const user = auth.currentUser;
      
      if (!roomName || !user) return;
      
      const roomRef = db.ref('xoxRooms').push();
      roomRef.set({
        name: roomName,
        owner: user.uid,
        ownerEmail: user.email,
        created: Date.now(),
        players: {
          [user.uid]: {
            email: user.email,
            joined: Date.now(),
            isOwner: true
          }
        },
        started: false
      }).then(() => {
        showToast('Oda olu≈üturuldu!');
        document.getElementById('room-name-input').value = '';
        loadRooms();
      });
    };

    document.getElementById('refresh-rooms-btn').onclick = loadRooms;

    function loadRooms() {
      const container = document.getElementById('room-list');
      container.innerHTML = '<div style="color:#ff9800;text-align:center;">Y√ºkleniyor...</div>';
      
      db.ref('xoxRooms').orderByChild('started').equalTo(false).once('value', snapshot => {
        const rooms = snapshot.val() || {};
        const keys = Object.keys(rooms);
        
        if (keys.length === 0) {
          container.innerHTML = '<div style="color:#ff9800;text-align:center;">A√ßƒ±k oda yok</div>';
        } else {
          container.innerHTML = '';
          keys.forEach(key => {
            const room = rooms[key];
            const div = document.createElement('div');
            div.className = 'room-item';
            div.innerHTML = `
              <span class="room-name">${room.name}</span>
              <button class="btn" style="padding:0.5rem 1rem;font-size:0.9rem;" onclick="joinRoom('${key}')">Katƒ±l</button>
            `;
            container.appendChild(div);
          });
        }
      });
    }

    window.joinRoom = function(roomId) {
      const user = auth.currentUser;
      if (!user) return showToast('Giri≈ü yapmalƒ±sƒ±nƒ±z!');
      
      const roomRef = db.ref('xoxRooms/' + roomId + '/players/' + user.uid);
      roomRef.set({
        email: user.email,
        joined: Date.now(),
        isOwner: false
      }).then(() => {
        showToast('Odaya katƒ±ldƒ±nƒ±z!');
        showGameLobby(roomId);
      });
    };

    function showGameLobby(roomId) {
      const roomRef = db.ref('xoxRooms/' + roomId);
      
      roomRef.on('value', snapshot => {
        const room = snapshot.val();
        if (!room) {
          closeModal();
          showToast('Oda bulunamadƒ±');
          return;
        }
        
        const players = room.players || {};
        const playerCount = Object.keys(players).length;
        
        let content = '<div style="text-align:center;"><h3 style="color:#ff9800;margin-bottom:1rem;">Oyuncular:</h3>';
        Object.values(players).forEach((p, i) => {
          content += `<div style="margin:0.5rem 0;color:#fff;">${i+1}. ${p.email}</div>`;
        });
        content += '</div>';
        
        const buttons = [
          { text: 'Odadan √áƒ±k', action: `leaveRoom('${roomId}')`, style: 'background:#23272b;color:#ff9800;' }
        ];
        
        const user = auth.currentUser;
        if (user && room.owner === user.uid && playerCount >= 2 && !room.started) {
          buttons.unshift({ text: 'Oyunu Ba≈ülat', action: `startGame('${roomId}')` });
        }
        
        showModal('Oda Lobisi: ' + room.name, content, buttons);
        
        if (room.started && room.game) {
          showGame(roomId, room);
        }
      });
    }

    window.leaveRoom = function(roomId) {
      const user = auth.currentUser;
      if (!user) return;
      
      db.ref('xoxRooms/' + roomId + '/players/' + user.uid).remove().then(() => {
        db.ref('xoxRooms/' + roomId + '/players').once('value', snap => {
          if (!snap.exists()) {
            db.ref('xoxRooms/' + roomId).remove();
          }
        });
        closeModal();
        loadRooms();
      });
    };

    window.startGame = function(roomId) {
      db.ref('xoxRooms/' + roomId).once('value', snapshot => {
        const room = snapshot.val();
        if (!room) return;
        
        const playerIds = Object.keys(room.players || {});
        if (playerIds.length < 2) return showToast('En az 2 oyuncu gerekli!');
        
        db.ref('xoxRooms/' + roomId).update({
          started: true,
          game: {
            board: Array(9).fill(''),
            turn: playerIds[0],
            winner: null,
            gameOver: false
          }
        });
      });
    };

    function showGame(roomId, room) {
      const user = auth.currentUser;
      const game = room.game;
      const playerIds = Object.keys(room.players);
      const isPlayer1 = user.uid === playerIds[0];
      const mySymbol = isPlayer1 ? 'X' : 'O';
      const isMyTurn = game.turn === user.uid;
      
      let content = `
        <div style="text-align:center;">
          <h3 style="color:#ff9800;margin-bottom:1rem;">X O X Oyunu</h3>
          <div style="margin-bottom:1rem;font-size:1.1rem;">
            Sƒ±ra: <span style="color:${isMyTurn ? '#43ea7b' : '#ff9800'};font-weight:700;">
              ${isMyTurn ? 'Sen (' + mySymbol + ')' : 'Rakip'}
            </span>
          </div>
          <div class="game-board">
      `;
      
      game.board.forEach((cell, idx) => {
        const cellClass = cell === 'X' ? 'x' : cell === 'O' ? 'o' : '';
        const disabled = cell || game.gameOver || !isMyTurn;
        content += `<button class="game-cell ${cellClass}" ${disabled ? 'disabled' : ''} onclick="makeMove('${roomId}', ${idx})">${cell}</button>`;
      });
      
      content += '</div>';
      
      if (game.winner) {
        const wonGame = (game.winner === 'X' && isPlayer1) || (game.winner === 'O' && !isPlayer1);
        content += `<div style="margin-top:1rem;font-size:1.2rem;font-weight:700;color:${wonGame ? '#43ea7b' : '#ff9800'};">
          ${wonGame ? 'Kazandƒ±n!' : 'Kaybettin!'}
        </div>`;
      } else if (game.board.every(c => c)) {
        content += '<div style="margin-top:1rem;font-size:1.2rem;font-weight:700;color:#fff;">Berabere!</div>';
      }
      
      content += '</div>';
      
      showModal('Oyun Devam Ediyor', content, [
        { text: 'Odadan √áƒ±k', action: `leaveRoom('${roomId}')`, style: 'background:#23272b;color:#ff9800;' }
      ]);
    }

    window.makeMove = function(roomId, cellIdx) {
      const user = auth.currentUser;
      
      db.ref('xoxRooms/' + roomId).transaction(room => {
        if (!room || !room.game || room.game.turn !== user.uid) return room;
        if (room.game.board[cellIdx] || room.game.gameOver) return room;
        
        const playerIds = Object.keys(room.players);
        const isPlayer1 = user.uid === playerIds[0];
        const symbol = isPlayer1 ? 'X' : 'O';
        
        room.game.board[cellIdx] = symbol;
        
        const winner = checkWinner(room.game.board);
        if (winner) {
          room.game.winner = winner;
          room.game.gameOver = true;
        } else if (room.game.board.every(c => c)) {
          room.game.gameOver = true;
        } else {
          room.game.turn = playerIds[isPlayer1 ? 1 : 0];
        }
        
        return room;
      });
    };

    function checkWinner(board) {
      const lines = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
      ];
      
      for (const [a, b, c] of lines) {
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return board[a];
        }
      }
      return null;
    }

    // User Info Modal
    document.getElementById('user-info-btn').onclick = function() {
      const user = auth.currentUser;
      if (!user) return;
      
      const content = `
        <div class="user-info-panel">
          <div class="user-info-row">
            <span class="user-info-label">üìß E-posta:</span>
            <span>${user.email}</span>
          </div>
          <div class="user-info-row">
            <span class="user-info-label">üÜî Kullanƒ±cƒ± ID:</span>
            <span style="font-size:0.85rem;">${user.uid}</span>
          </div>
          <div class="user-info-row">
            <span class="user-info-label">üìÖ Kayƒ±t Tarihi:</span>
            <span>${new Date(user.metadata.creationTime).toLocaleDateString('tr-TR')}</span>
          </div>
          <div class="user-info-row">
            <span class="user-info-label">‚è∞ Son Giri≈ü:</span>
            <span>${new Date(user.metadata.lastSignInTime).toLocaleDateString('tr-TR')}</span>
          </div>
        </div>
      `;
      
      showModal('Hesap Bilgileri', content, [
        { text: 'Kapat', action: 'closeModal()', style: 'background:#23272b;color:#ff9800;' }
      ]);
    };

    // Private Chat
    document.getElementById('special-chat-btn').onclick = function() {
      const content = `
        <div style="text-align:center;">
          <p style="margin-bottom:1rem;">√ñzel chat kodunu girin:</p>
          <input id="private-code-input" type="text" maxlength="12" placeholder="Kod..." 
            style="width:80%;padding:0.8rem;border-radius:10px;border:2px solid #7c3aed;background:#181a1b;color:#fff;font-size:1.1rem;text-align:center;" />
        </div>
      `;
      
      showModal('√ñzel Chat', content, [
        { text: 'A√ß', action: 'openPrivateChat()' },
        { text: 'ƒ∞ptal', action: 'closeModal()', style: 'background:#23272b;color:#ff9800;' }
      ]);
      
      setTimeout(() => document.getElementById('private-code-input')?.focus(), 100);
    };

    window.openPrivateChat = function() {
      const input = document.getElementById('private-code-input');
      const code = input?.value.trim();
      
      if (!code) return showToast('L√ºtfen bir kod girin!');
      
      closeModal();
      
      const content = `
        <div style="min-width:400px;max-width:90vw;">
          <div style="text-align:center;margin-bottom:1rem;">
            <span style="color:#ff9800;font-weight:700;">Kod: ${code}</span>
          </div>
          <div id="private-messages" class="chat-messages" style="height:300px;"></div>
          <form id="private-chat-form" style="display:flex;gap:0.5rem;margin-top:1rem;">
            <input id="private-input" type="text" maxlength="300" placeholder="Mesaj..." required 
              style="flex:1;padding:0.8rem;border-radius:10px;border:2px solid #7c3aed;background:#181a1b;color:#fff;" />
            <button type="submit" class="btn">G√∂nder</button>
          </form>
        </div>
      `;
      
      showModal('√ñzel Chat', content, [
        { text: 'Kapat', action: 'closePrivateChat()', style: 'background:#23272b;color:#ff9800;' }
      ]);
      
      ensureUsername();
      
      const form = document.getElementById('private-chat-form');
      form.onsubmit = function(e) {
        e.preventDefault();
        const input = document.getElementById('private-input');
        const text = input.value.trim();
        
        if (!text) return;
        
        db.ref('privateChats/' + code).push({
          user: username,
          text: text,
          time: Date.now()
        });
        
        input.value = '';
      };
      
      window.privateChatListener = db.ref('privateChats/' + code).limitToLast(50);
      window.privateChatListener.on('child_added', snapshot => {
        const msg = snapshot.val();
        const container = document.getElementById('private-messages');
        if (!container) return;
        
        const div = document.createElement('div');
        div.className = 'chat-message';
        div.innerHTML = `<span class="chat-user">${msg.user}:</span> <span class="chat-text">${msg.text}</span>`;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
      });
    };

    window.closePrivateChat = function() {
      if (window.privateChatListener) {
        window.privateChatListener.off();
        window.privateChatListener = null;
      }
      closeModal();
    };

    // Scroll to Top
    document.getElementById('scroll-top-btn').onclick = function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.onscroll = function() {
      const btn = document.getElementById('scroll-top-btn');
      btn.style.display = window.scrollY > 300 ? 'flex' : 'none';
    };

    // Footer Links
    document.getElementById('about-link').onclick = function(e) {
      e.preventDefault();
      showModal('Hakkƒ±nda', `
        <p>Top-Secret, g√ºvenli ve modern bir sohbet, √∂zel chat ve oyun platformudur.</p>
        <p>T√ºm verileriniz Firebase √ºzerinde g√ºvenli ≈üekilde saklanƒ±r.</p>
      `, [{ text: 'Kapat', action: 'closeModal()' }]);
    };

    document.getElementById('terms-link').onclick = function(e) {
      e.preventDefault();
      showModal('Kullanƒ±m Ko≈üullarƒ±', `
        <p>Bu platformu kullanarak gizlilik ve g√ºvenlik kurallarƒ±nƒ± kabul etmi≈ü olursunuz.</p>
        <p>K√∂t√ºye kullanƒ±m tespit edilirse eri≈üim engellenebilir.</p>
      `, [{ text: 'Kapat', action: 'closeModal()' }]);
    };

    document.getElementById('shortcuts-link').onclick = function(e) {
      e.preventDefault();
      showModal('Klavye Kƒ±sayollarƒ±', `
        <ul style="text-align:left;line-height:2;">
          <li><strong>Enter:</strong> Mesaj g√∂nder</li>
          <li><strong>ESC:</strong> Modal kapat</li>
          <li><strong>/clear:</strong> Sohbeti temizle</li>
        </ul>
      `, [{ text: 'Kapat', action: 'closeModal()' }]);
    };

    // ESC to close modal
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeModal();
    });

    // Click outside to close modal
    document.getElementById('modal-bg').onclick = closeModal;

    // Cleanup on unload
    window.addEventListener('beforeunload', removeOnlineUser);
  </script>
</body>
</html>
    