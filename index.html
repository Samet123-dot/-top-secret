<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Top-Secret</title>
  <meta name="description" content="Top-Secret: Güvenli ve modern sohbet, özel chat ve oyun platformu.">
  <meta property="og:title" content="Top-Secret" />
  <meta property="og:description" content="Güvenli ve modern sohbet, özel chat ve oyun platformu." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="favicon.png" />
  <meta property="og:url" content="" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Top-Secret" />
  <meta name="twitter:description" content="Güvenli ve modern sohbet, özel chat ve oyun platformu." />
  <meta name="twitter:image" content="favicon.png" />
  <meta name="theme-color" content="#232136" />
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      background: #181a1b;
      color: #f5f5f7;
      font-family: 'Inter', Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding: 0;
    }
    .auth-card {
      background: #232136;
      border-radius: 22px;
      box-shadow: 0 8px 32px #7c3aed33, 0 1.5px 0 #23272b;
      padding: 2.5rem 2.1rem 2.1rem 2.1rem;
      width: 100%;
      max-width: 370px;
      position: relative;
      z-index: 1;
      animation: cardFadeIn 1.1s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @keyframes cardFadeIn {
      0% { opacity: 0; transform: translateY(-60px) scale(0.98); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    .auth-title {
      font-size: 2rem;
      font-weight: bold;
      color: #ff9800;
      text-align: center;
      margin-bottom: 1.2rem;
      letter-spacing: 1px;
      text-shadow: 0 2px 8px #7c3aed33;
    }
    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1.1em;
    }
    .auth-form input {
      background: #181a1b;
      color: #f5f5f7;
      border: 1.5px solid #7c3aed;
      border-radius: 12px;
      font-size: 1.08rem;
      padding: 0.7em 1.1em;
      transition: box-shadow 0.3s, border-color 0.3s, background 0.3s;
      outline: none;
    }
    .auth-form input:focus {
      box-shadow: 0 0 0 3px #ff9800cc, 0 2px 8px #7c3aed44;
      border-color: #ff9800;
      background: #232136;
    }
    .auth-btn {
      background: linear-gradient(90deg, #7c3aed 0%, #ff9800 100%);
      border: none;
      color: #fff;
      border-radius: 12px;
      font-weight: bold;
      font-size: 1.08rem;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px #7c3aed22;
      padding: 0.7em 1.2em;
      cursor: pointer;
      transition: transform 0.18s cubic-bezier(.68,-0.55,.27,1.55), box-shadow 0.18s;
    }
    .auth-btn:hover, .auth-btn:focus {
      background: linear-gradient(90deg, #ff9800 0%, #7c3aed 100%);
      color: #fff;
      transform: scale(1.06) translateY(-2px) rotate(-1deg);
      box-shadow: 0 6px 24px #ff980044;
    }
    .auth-switch {
      background: none;
      border: none;
      color: #7c3aed;
      font-weight: bold;
      margin-top: 0.5em;
      cursor: pointer;
      text-align: center;
      font-size: 1rem;
      text-decoration: underline;
      transition: color 0.2s;
    }
    .auth-switch:hover { color: #ff9800; }
    .auth-error {
      color: #ff6b6b;
      font-size: 1.04rem;
      margin-top: 0.5rem;
      text-align: center;
      min-height: 1.2em;
    }
    .auth-success {
      color: #43ea7b;
      font-size: 1.04rem;
      margin-top: 0.5rem;
      text-align: center;
      min-height: 1.2em;
    }
    @media (max-width: 600px) {
      .auth-card {
        max-width: 98vw;
        padding: 1.2rem 0.5rem 1.2rem 0.5rem;
        border-radius: 18px;
      }
      .auth-title { font-size: 1.4rem; }
    }
    .chat-card {
      background: #232136;
      border-radius: 22px;
      box-shadow: 0 8px 32px #7c3aed33, 0 1.5px 0 #23272b;
      padding: 2.1rem 1.2rem 1.2rem 1.2rem;
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      height: 70vh;
      min-height: 400px;
      position: relative;
      z-index: 2;
      animation: cardFadeIn 1.1s cubic-bezier(.68,-0.55,.27,1.55);
    }
    .chat-title {
      color: #ff9800;
      font-size: 1.4rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 1.1rem;
      letter-spacing: 1px;
      text-shadow: 0 2px 8px #7c3aed33;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      background: #181a1b;
      border-radius: 12px;
      padding: 1rem;
      font-size: 1.08rem;
      color: #fff;
      box-shadow: 0 2px 8px #7c3aed22;
      margin-bottom: 1rem;
    }
    .chat-message {
      margin-bottom: 0.7em;
      word-break: break-word;
      display: flex;
      align-items: flex-end;
    }
    .chat-user {
      color: #ff9800;
      font-weight: bold;
      margin-right: 0.4em;
    }
    .chat-text {
      color: #fff;
    }
    .chat-form {
      display: flex;
      gap: 0.5em;
    }
    #chat-input {
      flex: 1;
      border-radius: 10px;
      border: 1.5px solid #7c3aed;
      background: #181a1b;
      color: #fff;
      padding: 0.6em 1em;
      font-size: 1.08rem;
      outline: none;
      transition: border-color 0.3s;
    }
    #chat-input:focus {
      border-color: #ff9800;
    }
    #chat-send {
      background: linear-gradient(90deg, #7c3aed 0%, #ff9800 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1.08rem;
      padding: 0.6em 1.2em;
      cursor: pointer;
      transition: background 0.3s, transform 0.18s;
    }
    #chat-send:hover {
      background: linear-gradient(90deg, #ff9800 0%, #7c3aed 100%);
      transform: scale(1.06) translateY(-2px) rotate(-1deg);
    }
    .logout-btn {
      margin-top:1.2em;
      background:linear-gradient(90deg,#7c3aed 0%,#ff9800 100%);
      color:#fff;
      font-weight:bold;
      border:none;
      border-radius:10px;
      padding:0.6em 1.2em;
      cursor:pointer;
      transition:background 0.3s;
    }
    .logout-btn:hover {
      background:linear-gradient(90deg,#ff9800 0%,#7c3aed 100%);
      color:#23272b;
    }
    @media (max-width: 600px) {
      .chat-card {
        max-width: 98vw;
        padding: 1.2rem 0.5rem 1.2rem 0.5rem;
        border-radius: 18px;
        height: 60vh;
        min-height: 300px;
      }
      .chat-messages { font-size: 1rem; padding: 0.7rem; }
      .chat-message { font-size: 1rem; padding: 0.6em 0.8em; }
    }
    #user-info-panel {
      background: linear-gradient(135deg, #232136 70%, #7c3aed22 100%);
      border-radius: 22px;
      box-shadow: 0 8px 32px #7c3aed33, 0 1.5px 0 #23272b;
      padding: 1.7rem 1.2rem 1.2rem 1.2rem;
      min-width: 280px;
      max-width: 320px;
      color: #fff;
      display: flex;
      flex-direction: column;
      gap: 0.7em;
      font-size: 1.07rem;
      align-self: flex-start;
      margin-top: 0.5rem;
      margin-left: 0.2rem;
      border: 2px solid #7c3aed44;
      transition: box-shadow 0.3s, border-color 0.3s, transform 0.2s;
      position: relative;
      overflow: hidden;
      z-index: 3;
      animation: userInfoFadeIn 1.1s cubic-bezier(.68,-0.55,.27,1.55);
      max-height: 100%;
      overflow-y: auto;
    }
    @keyframes userInfoFadeIn {
      0% { opacity: 0; transform: translateY(-40px) scale(0.98); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    #user-info-panel:hover {
      box-shadow: 0 12px 40px #ff980044, 0 2px 8px #7c3aed44;
      border-color: #ff9800;
      transform: scale(1.025) translateY(-2px);
    }
    .user-info-avatar {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 0.7em;
      margin-top: -1.1em;
      animation: avatarPop 1.2s cubic-bezier(.68,-0.55,.27,1.55);
    }
    @keyframes avatarPop {
      0% { opacity: 0; transform: scale(0.7); }
      100% { opacity: 1; transform: scale(1); }
    }
    .user-info-title {
      font-weight: bold;
      font-size: 1.18rem;
      color: #ff9800;
      margin-bottom: 0.7em;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 8px #7c3aed22;
      text-align: center;
    }
    .user-info-row {
      display: flex;
      align-items: center;
      background: rgba(36, 37, 50, 0.92);
      border-radius: 16px;
      padding: 0.7em 1.1em;
      margin-bottom: 0.55em;
      font-size: 1.02rem;
      word-break: break-word;
      overflow-wrap: anywhere;
      box-shadow: 0 2px 10px #7c3aed0a;
      gap: 0.7em;
      min-height: 38px;
      justify-content: space-between;
    }
    .user-info-icon {
      font-size: 1.15em;
      margin-right: 0.38em;
      opacity: 0.82;
      flex-shrink: 0;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .user-info-label {
      font-weight: 500;
      color: #ff9800;
      margin-right: 0.7em;
      min-width: 90px;
      font-size: 1em;
      letter-spacing: 0.1px;
      display: flex;
      align-items: center;
      opacity: 0.95;
      flex-shrink: 0;
      text-align: left;
    }
    .user-info-row span[id^="user-"] {
      font-weight: 700;
      color: #fff;
      font-size: 1.04em;
      margin-left: 0.1em;
      letter-spacing: 0.05px;
      text-shadow: 0 1px 4px #23213633;
      flex: 1;
      text-align: right;
      line-height: 1.3;
      display: block;
      max-width: 170px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }
    .user-info-row span[id^="user-"]:hover {
      white-space: normal;
      overflow: visible;
      background: #181a1b;
      z-index: 10;
      border-radius: 6px;
      box-shadow: 0 2px 8px #7c3aed33;
      padding: 0.1em 0.3em;
      position: relative;
    }
    .user-info-row span.user-id, .user-info-row span.user-email {
      font-size: 0.97em;
      word-break: break-all;
      max-width: 170px;
      display: block;
    }
    @media (max-width: 900px) {
      #chat-container > div {
        flex-direction: column;
        align-items: stretch;
        gap: 1.2rem;
      }
      #user-info-panel {
        max-width: 98vw;
        min-width: unset;
        margin: 0 auto;
        margin-bottom: 1.2rem;
        max-height: unset;
        overflow-y: visible;
      }
    }
  </style>
</head>
<body>
  <div style="width:100vw;text-align:center;padding:1.2em 0 0.2em 0;display:flex;align-items:center;justify-content:center;gap:1.2em;">
    <span style="font-size:2.2rem;font-weight:bold;color:#ff9800;letter-spacing:2px;text-shadow:0 2px 8px #7c3aed33;">Top-Secret</span>
    <button id="theme-toggle-btn" title="Tema Değiştir" style="margin-left:1em;font-size:1.3em;padding:0.3em 0.7em;border-radius:8px;border:none;background:#232136;color:#ff9800;cursor:pointer;">🌙</button>
    <button id="lang-toggle-btn" title="Dili Değiştir" style="margin-left:0.5em;font-size:1.1em;padding:0.3em 0.7em;border-radius:8px;border:none;background:#232136;color:#43ea7b;cursor:pointer;">EN</button>
  </div>
  <div id="welcome-msg" style="text-align:center;font-size:1.1em;color:#43ea7b;font-weight:bold;margin-bottom:0.5em;display:none;"></div>
  <div id="toast-container" style="position:fixed;top:24px;right:24px;z-index:5000;display:flex;flex-direction:column;gap:0.7em;"></div>
  <div id="scroll-top-btn" title="Yukarı Çık" style="display:none;position:fixed;right:32px;bottom:180px;z-index:1002;width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#7c3aed 60%,#ff9800 100%);box-shadow:0 4px 18px #7c3aed44;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform 0.18s;outline:none;font-size:2em;color:#fff;"><span>↑</span></div>
  <div id="about-modal-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,27,0.65);z-index:4000;"></div>
  <div id="about-modal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:4001;background:#232136;padding:2em 2.5em;border-radius:18px;box-shadow:0 8px 32px #7c3aed33;min-width:320px;max-width:98vw;text-align:center;color:#fff;"></div>
  <div id="shortcuts-modal-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,27,0.65);z-index:4100;"></div>
  <div id="shortcuts-modal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:4101;background:#232136;padding:2em 2.5em;border-radius:18px;box-shadow:0 8px 32px #7c3aed33;min-width:320px;max-width:98vw;text-align:center;color:#fff;"></div>
  <div id="loading-spinner" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:6000;background:rgba(24,26,27,0.45);align-items:center;justify-content:center;"><div style="border:6px solid #7c3aed;border-top:6px solid #ff9800;border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;"></div></div>
  <style>@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style>
  <div class="auth-card" id="auth-container">
    <div class="auth-title" id="form-title">Top-Secret</div>
    <form class="auth-form" id="login-form" autocomplete="off">
      <input type="email" id="login-email" placeholder="E-posta" required />
      <input type="password" id="login-password" placeholder="Şifre" required minlength="6" />
      <button type="submit" class="auth-btn">Giriş Yap</button>
      <div class="auth-error" id="login-error"></div>
      <button type="button" class="auth-switch" id="show-signup">Hesabın yok mu? Kayıt Ol</button>
    </form>
    <form class="auth-form" id="signup-form" autocomplete="off" style="display:none;">
      <input type="email" id="signup-email" placeholder="E-posta" required />
      <input type="password" id="signup-password" placeholder="Şifre" required minlength="6" />
      <button type="submit" class="auth-btn">Kayıt Ol</button>
      <div class="auth-error" id="signup-error"></div>
      <div class="auth-success" id="signup-success"></div>
      <button type="button" class="auth-switch" id="show-login">Zaten hesabın var mı? Giriş Yap</button>
    </form>
  </div>
  <div id="chat-container" style="display:none;">
    <div style="display:flex;gap:1.5rem;justify-content:center;align-items:flex-start;">
      <div class="chat-card">
        <div class="chat-title">Sohbet</div>
        <div id="chat-messages" class="chat-messages"></div>
        <form id="chat-form" class="chat-form" autocomplete="off">
          <input id="chat-input" type="text" placeholder="Mesajınızı yazın..." maxlength="300" required />
          <button id="chat-send" type="submit">Gönder</button>
        </form>
        <button id="logout-btn" class="logout-btn">Çıkış Yap</button>
      </div>
      <div class="chat-card" id="image-chat-card" style="max-width:420px;min-width:320px;">
        <div class="chat-title">Online Olan Kişiler</div>
        <div id="online-users-list" class="chat-messages" style="min-height:180px;display:flex;flex-direction:column;gap:0.7em;"></div>
      </div>
      <!-- Bilgi paneli ana ekranda gösterilmeyecek, modal olarak açılacak -->
      <div id="user-info-panel" style="display:none;"></div>
    </div>
    <!-- Sağ alt özel chat butonu -->
    <button id="special-chat-btn" title="Özel Chat" style="position:fixed;right:32px;bottom:100px;z-index:1001;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#ff9800 60%,#7c3aed 100%);box-shadow:0 4px 18px #ff980044;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform 0.18s;outline:none;margin-bottom:12px;">
      <span style="font-size:2.1rem;color:#fff;">📡</span>
    </button>
    <!-- Özel Chat Modalı -->
    <div id="special-chat-modal-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,27,0.65);z-index:2000;"></div>
    <div id="special-chat-modal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:2001;"></div>
    <!-- Sağ alt bilgi butonu -->
    <button id="show-user-info-btn" title="Hesap Bilgileri" style="position:fixed;right:32px;bottom:32px;z-index:1001;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#7c3aed 60%,#ff9800 100%);box-shadow:0 4px 18px #7c3aed44;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform 0.18s;outline:none;">
      <span style="font-size:2.1rem;color:#fff;">👤</span>
    </button>
    <!-- Modal arka planı ve bilgi paneli -->
    <div id="user-info-modal-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,27,0.65);z-index:1000;"></div>
    <div id="user-info-modal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1002;"></div>
  </div>
  <div id="xox-lobby-container" style="display:none;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;background:#181a1b;">
    <div class="auth-card" style="max-width:440px;width:100%;margin-bottom:2rem;">
      <div class="auth-title">XOX Odaları</div>
      <form id="create-xox-room-form" class="auth-form" style="margin-bottom:1.2em;">
        <input type="text" id="xox-room-name-input" placeholder="Oda adı (örn: XOX-1)" required minlength="2" maxlength="20" />
        <button type="submit" class="auth-btn">Oda Oluştur</button>
      </form>
      <div id="xox-room-list" style="margin-bottom:1em;"></div>
      <button id="refresh-xox-rooms-btn" class="auth-switch" style="margin-top:0.5em;">Odaları Yenile</button>
      <button id="back-to-chat-xox-btn" class="auth-switch" style="margin-top:0.5em;">Sohbete Dön</button>
    </div>
    <div id="xox-room-lobby" class="auth-card" style="max-width:440px;width:100%;display:none;">
      <div class="auth-title" id="xox-room-lobby-title">Oda Lobisi</div>
      <div id="xox-room-players-list" style="margin-bottom:1em;"></div>
      <button id="start-xox-game-btn" class="auth-btn" style="display:none;">Oyunu Başlat</button>
      <button id="leave-xox-room-btn" class="auth-switch" style="margin-top:0.5em;">Odadan Çık</button>
    </div>
  </div>
  <div id="xox-game-modal-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,27,0.97);z-index:4000;"></div>
  <div id="xox-game-modal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:4001;"></div>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("Gy90aa1c2OepdW7pi");
    })();
  </script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD39X1qF5C39TYzPcOhmo5lJVlRfU-dRvc",
      authDomain: "top-secret-a5628.firebaseapp.com",
      projectId: "top-secret-a5628",
      storageBucket: "top-secret-a5628.appspot.com",
      messagingSenderId: "854924115836",
      appId: "1:854924115836:web:be1a865f48e7a868376ef9",
      measurementId: "G-36WWQ06YRK"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Formlar arası geçiş
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const showSignupBtn = document.getElementById('show-signup');
    const showLoginBtn = document.getElementById('show-login');
    const formTitle = document.getElementById('form-title');
    showSignupBtn.onclick = function() {
      loginForm.style.display = 'none';
      signupForm.style.display = 'flex';
      formTitle.textContent = 'Kayıt Ol';
    };
    showLoginBtn.onclick = function() {
      signupForm.style.display = 'none';
      loginForm.style.display = 'flex';
      formTitle.textContent = 'Giriş Yap';
    };

    // Giriş
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');
      errorDiv.textContent = '';
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          errorDiv.style.color = '#43ea7b';
          errorDiv.textContent = 'Giriş başarılı!';
          setTimeout(() => {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
          }, 700);
        })
        .catch(err => {
          errorDiv.style.color = '#ff6b6b';
          errorDiv.textContent = err.message;
        });
    });

    // Kayıt
    signupForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const errorDiv = document.getElementById('signup-error');
      const successDiv = document.getElementById('signup-success');
      errorDiv.textContent = '';
      successDiv.textContent = '';
      // 6 haneli kod üret
      const code = Math.floor(100000 + Math.random() * 900000);
      // EmailJS ile kodu gönder
      emailjs.send("service_a1d2neu", "template_3r4mr8b", {
        to_email: email,
        code: code
      })
      .then(function() {
        showCodeModal(code, email, password);
      }, function(error) {
        errorDiv.textContent = "Kod gönderilemedi: " + error.text;
      });
    });

    // Doğrulama kodu modalı oluştur (modern, dark theme)
    function showCodeModal(expectedCode, email, password) {
      let modal = document.getElementById('verify-modal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'verify-modal';
        modal.innerHTML = `
          <div class="verify-modal-bg"></div>
          <div class="verify-modal-content dark-modal">
            <h4>E-posta Doğrulama</h4>
            <p>Mail adresinize gönderilen <span style=\"color:#ff9800;font-weight:bold\">6 haneli kodu</span> girin:</p>
            <input id="verify-code-input" type="text" maxlength="6" pattern="[0-9]{6}" style="font-size:1.3rem;text-align:center;letter-spacing:0.3em;padding:0.5em 1em;border-radius:8px;border:1.5px solid #7c3aed;width:80%;margin-bottom:1em;background:#181a1b;color:#fff;" autofocus />
            <div id="verify-timer" style="margin-bottom:1em;color:#ff9800;font-weight:bold;font-size:1.1rem;">30</div>
            <button id="verify-submit-btn" style="background:linear-gradient(90deg,#7c3aed 0%,#ff9800 100%);color:#fff;font-weight:bold;border:none;border-radius:8px;padding:0.6em 1.2em;cursor:pointer;">Doğrula</button>
            <button id="verify-cancel-btn" style="background:#23272b;color:#ff9800;font-weight:bold;border:none;border-radius:8px;padding:0.6em 1.2em;cursor:pointer;margin-left:1em;">İptal</button>
            <div id="verify-error" style="color:#ff6b6b;margin-top:0.7em;"></div>
          </div>
        `;
        document.body.appendChild(modal);
      } else {
        modal.style.display = 'block';
      }
      document.body.style.overflow = 'hidden';
      let timer = 30;
      const timerEl = modal.querySelector('#verify-timer');
      const errorEl = modal.querySelector('#verify-error');
      timerEl.textContent = timer;
      errorEl.textContent = '';
      modal.querySelector('#verify-code-input').value = '';
      modal.querySelector('#verify-submit-btn').disabled = false;
      let interval = setInterval(() => {
        timer--;
        timerEl.textContent = timer;
        if (timer <= 0) {
          clearInterval(interval);
          errorEl.textContent = 'Süre doldu. Lütfen tekrar kayıt olun.';
          modal.querySelector('#verify-submit-btn').disabled = true;
        }
      }, 1000);
      modal.querySelector('#verify-submit-btn').onclick = function() {
        const val = modal.querySelector('#verify-code-input').value.trim();
        if (val === expectedCode.toString()) {
          clearInterval(interval);
          modal.style.display = 'none';
          document.body.style.overflow = '';
          // Kayıt işlemini tamamla
          firebase.auth().createUserWithEmailAndPassword(email, password)
            .then(() => {
              document.getElementById('signup-success').textContent = 'Kayıt başarılı! Şimdi giriş yapabilirsin.';
              setTimeout(() => {
                document.getElementById('show-login').click();
              }, 1200);
            })
            .catch(err => {
              document.getElementById('signup-error').textContent = err.message;
            });
        } else {
          errorEl.textContent = 'Kod yanlış!';
        }
      };
      modal.querySelector('#verify-cancel-btn').onclick = function() {
        clearInterval(interval);
        modal.style.display = 'none';
        document.body.style.overflow = '';
      };
    }

    // Oturum kontrolü: Sayfa yüklenince girişli mi kontrol et
    auth.onAuthStateChanged(function(user) {
      if (user) {
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('chat-container').style.display = 'flex';
        // Kullanıcı bilgilerini göster (paneli modalda kullanmak için HTML'ini oluştur)
        const userInfoHtml = `
          <div class="user-info-avatar">
            <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="30" cy="30" r="28" fill="url(#avatarGradient)" stroke="#7c3aed" stroke-width="2"/>
              <ellipse cx="30" cy="26" rx="11" ry="11" fill="#fff" fill-opacity="0.95"/>
              <ellipse cx="30" cy="47" rx="16" ry="9" fill="#fff" fill-opacity="0.7"/>
              <defs>
                <linearGradient id="avatarGradient" x1="0" y1="0" x2="60" y2="60" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#7c3aed"/>
                  <stop offset="1" stop-color="#ff9800"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div class="user-info-title">Hesap Bilgileri <button id='close-user-info-modal' style='float:right;background:none;border:none;font-size:1.5rem;color:#ff9800;cursor:pointer;margin-top:-0.2em;' title='Kapat'>&times;</button></div>
          <div class="user-info-row"><span class="user-info-icon">📧</span><span class="user-info-label">E-posta:</span> <span id="user-email" class="user-email" title="${user.email || '-'}">${user.email || '-'}</span></div>
          <div class="user-info-row"><span class="user-info-icon">🆔</span><span class="user-info-label">Kullanıcı ID:</span> <span id="user-uid" class="user-id" title="${user.uid || '-'}">${user.uid || '-'}</span></div>
          <div class="user-info-row"><span class="user-info-icon">📅</span><span class="user-info-label">Kayıt Tarihi:</span> <span id="user-created">${user.metadata && user.metadata.creationTime ? new Date(user.metadata.creationTime).toLocaleString('tr-TR') : '-'}</span></div>
          <div class="user-info-row"><span class="user-info-icon">⏰</span><span class="user-info-label">Son Giriş:</span> <span id="user-lastlogin">${user.metadata && user.metadata.lastSignInTime ? new Date(user.metadata.lastSignInTime).toLocaleString('tr-TR') : '-'}</span></div>
        `;
        document.getElementById('user-info-panel').innerHTML = userInfoHtml;
        document.getElementById('user-info-modal').innerHTML = userInfoHtml;
      } else {
        document.getElementById('chat-container').style.display = 'none';
        document.getElementById('auth-container').style.display = 'block';
      }
    });
   // Bilgi butonu ve modal açma/kapama
   const showUserInfoBtn = document.getElementById('show-user-info-btn');
   const userInfoModalBg = document.getElementById('user-info-modal-bg');
   const userInfoModal = document.getElementById('user-info-modal');
   showUserInfoBtn.onclick = function() {
     userInfoModalBg.style.display = 'block';
     userInfoModal.style.display = 'block';
     // Kapat butonunu her açışta yeniden bağla
     setTimeout(() => {
       const closeBtn = document.getElementById('close-user-info-modal');
       if (closeBtn) closeBtn.onclick = closeUserInfoModal;
     }, 50);
   };
   userInfoModalBg.onclick = closeUserInfoModal;
   function closeUserInfoModal() {
     userInfoModalBg.style.display = 'none';
     userInfoModal.style.display = 'none';
   }
  </script>
  <script>
    // Realtime Database bağlantısı
    const db = firebase.database();
    // Chat için kullanıcı adı sor (localStorage'da yoksa)
    let username = localStorage.getItem('chat-username');
    function askUsername() {
      username = prompt('Kullanıcı adınızı girin:');
      if (username && username.trim().length > 0) {
        localStorage.setItem('chat-username', username);
      } else {
        askUsername();
      }
    }
    // Chat ekranı açıldığında kullanıcı adı sor
    function ensureUsername() {
      if (!username) askUsername();
    }
    // Chat mesaj gönderme
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    let chatCooldown = false;
    let cooldownTimeout = null;
    let messageCount = 0;
    // Cooldown uyarısı için bir div ekle
    let cooldownDiv = document.getElementById('chat-cooldown');
    if (!cooldownDiv) {
      cooldownDiv = document.createElement('div');
      cooldownDiv.id = 'chat-cooldown';
      cooldownDiv.style.color = '#ff9800';
      cooldownDiv.style.fontWeight = 'bold';
      cooldownDiv.style.textAlign = 'center';
      cooldownDiv.style.margin = '0.3em 0 0.2em 0';
      cooldownDiv.style.minHeight = '1.2em';
      chatForm.parentNode.insertBefore(cooldownDiv, chatForm);
    }
    chatForm.addEventListener('submit', function(e) {
      e.preventDefault();
      if (chatCooldown) return;
      ensureUsername();
      const text = chatInput.value.trim();
      if (!text) return;
      if (text === '/clear') {
        // Mesajları sil
        db.ref('messages').remove().then(() => {
          chatMessages.innerHTML = '';
          cooldownDiv.textContent = 'Sohbet temizlendi!';
          setTimeout(() => { cooldownDiv.textContent = ''; }, 2000);
        });
      } else {
        db.ref('messages').push({
          user: username,
          text: text,
          time: Date.now()
        });
      }
      chatInput.value = '';
      messageCount++;
      if (messageCount >= 3) {
        // 2 saniye cooldown başlat
        chatCooldown = true;
        chatInput.disabled = true;
        chatForm.querySelector('button[type="submit"]').disabled = true;
        let remaining = 2;
        cooldownDiv.textContent = `${remaining} saniye bekleyin...`;
        cooldownTimeout = setInterval(() => {
          remaining--;
          if (remaining > 0) {
            cooldownDiv.textContent = `${remaining} saniye bekleyin...`;
          } else {
            clearInterval(cooldownTimeout);
            chatCooldown = false;
            chatInput.disabled = false;
            chatForm.querySelector('button[type="submit"]').disabled = false;
            cooldownDiv.textContent = '';
            messageCount = 0;
          }
        }, 1000);
      }
    });
    // Mesajları dinle ve ekrana yaz
    db.ref('messages').limitToLast(50).on('child_added', function(snapshot) {
      const msg = snapshot.val();
      const msgDiv = document.createElement('div');
      msgDiv.className = 'chat-message';
      msgDiv.innerHTML = `<span class=\"chat-user\">${msg.user}:</span> <span class=\"chat-text\">${msg.text}</span>`;
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    });
    // Çıkışta kullanıcı adı silinsin
    document.getElementById('logout-btn').onclick = function() {
      auth.signOut();
      localStorage.removeItem('chat-username');
    };

    // Firebase Storage başlat
    const storage = firebase.storage();

    // Online Olan Kişiler
    const onlineUsersList = document.getElementById('online-users-list');
    let onlineUserKey = null;
    function setOnlineUser() {
      ensureUsername();
      // Önce aynı kullanıcı adını taşıyan eski kayıtları sil
      db.ref('onlineUsers').orderByChild('username').equalTo(username).once('value', function(snapshot) {
        snapshot.forEach(function(child) {
          child.ref.remove();
        });
        // Sonra yeni kaydı ekle
        const userRef = db.ref('onlineUsers').push({
          username: username,
          time: Date.now()
        });
        onlineUserKey = userRef.key;
        // Bağlantı kesilirse otomatik sil
        userRef.onDisconnect().remove();
      });
    }
    function removeOnlineUser() {
      if (onlineUserKey) {
        db.ref('onlineUsers/' + onlineUserKey).remove();
        onlineUserKey = null;
      }
    }
    // Girişte online olarak ekle
    window.addEventListener('load', setOnlineUser);
    // Çıkışta veya sayfa kapanınca online listesinden çıkar
    window.addEventListener('beforeunload', removeOnlineUser);
    document.getElementById('logout-btn').addEventListener('click', removeOnlineUser);
    // Online kullanıcıları dinle ve listele
    db.ref('onlineUsers').on('value', function(snapshot) {
      const users = snapshot.val() || {};
      onlineUsersList.innerHTML = '';
      const userNames = Object.values(users).map(u => u.username);
      if (userNames.length === 0) {
        onlineUsersList.innerHTML = '<div style="color:#ff9800;text-align:center;">Şu anda kimse online değil</div>';
      } else {
        userNames.forEach(name => {
          const div = document.createElement('div');
          div.style.display = 'flex';
          div.style.alignItems = 'center';
          div.style.gap = '0.5em';
          div.innerHTML = `<span style='font-size:1.2em;'>🟢</span> <span style='font-weight:bold;color:#fff;'>${name}</span>`;
          onlineUsersList.appendChild(div);
        });
      }
    });
  </script>
  <script>
    // XOX Oyununu başlat
    function showXOXGame() {
      const bg = document.getElementById('xox-game-modal-bg');
      const modal = document.getElementById('xox-game-modal');
      bg.style.display = 'block';
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden';
      let board = Array(9).fill('');
      let turn = 'X';
      let gameOver = false;
      let score = { X: 0, O: 0 };
      function render() {
        let html = `<div style='background:#232136;padding:2.2em 2.5em;border-radius:18px;box-shadow:0 8px 32px #7c3aed33;min-width:320px;max-width:98vw;text-align:center;animation:modalPopIn 0.5s cubic-bezier(.68,-0.55,.27,1.55);display:flex;flex-direction:column;align-items:center;'>`;
        html += `<div style='font-size:1.3em;font-weight:bold;color:#ff9800;margin-bottom:0.7em;'>X O X (Tic Tac Toe)</div>`;
        html += `<div style='margin-bottom:0.7em;font-size:1.1em;color:#fff;'>Sıra: <span style='color:${turn==="X"?"#43ea7b":"#ff9800"};font-weight:bold;'>${turn}</span></div>`;
        html += `<div style='display:flex;gap:2em;margin-bottom:1em;'><div style='color:#43ea7b;font-weight:bold;'>X: ${score.X}</div><div style='color:#ff9800;font-weight:bold;'>O: ${score.O}</div></div>`;
        html += `<div id='xox-board' style='display:grid;grid-template-columns:repeat(3,72px);grid-template-rows:repeat(3,72px);gap:12px;margin-bottom:1.2em;'>`;
        for(let i=0;i<9;i++) {
          html += `<button class='xox-cell' data-idx='${i}' style='width:72px;height:72px;font-size:2.2em;font-weight:bold;border-radius:16px;background:#181a1b;color:${board[i]==='X'?'#43ea7b':board[i]==='O'?'#ff9800':'#fff'};border:3px solid #7c3aed;box-shadow:0 2px 8px #7c3aed22;transition:background 0.2s, color 0.2s;cursor:${board[i]||gameOver?'not-allowed':'pointer'};'>${board[i]}</button>`;
        }
        html += `</div>`;
        html += `<div id='xox-status' style='min-height:2em;font-size:1.1em;font-weight:bold;color:#ff9800;margin-bottom:1em;'></div>`;
        html += `<div style='display:flex;gap:1.2em;justify-content:center;'>`;
        html += `<button id='xox-restart-btn' class='uno-game-btn'>Yeniden Oyna</button>`;
        html += `<button id='xox-close-btn' class='uno-game-btn' style='background:#232136;color:#ff9800;border:2px solid #ff9800;'>Sohbete Dön</button>`;
        html += `</div></div>`;
        modal.innerHTML = html;
        // Oyun durumu kontrolü
        const winner = checkWinner(board);
        const statusDiv = document.getElementById('xox-status');
        if (winner) {
          statusDiv.textContent = `Kazanan: ${winner}`;
          statusDiv.style.color = winner==='X'?'#43ea7b':'#ff9800';
        } else if (board.every(cell => cell)) {
          statusDiv.textContent = 'Beraberlik!';
          statusDiv.style.color = '#fff';
        } else {
          statusDiv.textContent = '';
        }
        // Hücrelere tıklama
        document.querySelectorAll('.xox-cell').forEach(btn => {
          btn.onclick = function() {
            const idx = parseInt(btn.getAttribute('data-idx'));
            if (board[idx] || gameOver) return;
            board[idx] = turn;
            const win = checkWinner(board);
            if (win) {
              gameOver = true;
              score[win]++;
            } else if (board.every(cell => cell)) {
              gameOver = true;
            } else {
              turn = turn === 'X' ? 'O' : 'X';
            }
            render();
        }});
        // Yeniden oyna
        document.getElementById('xox-restart-btn').onclick = function() {
          board = Array(9).fill('');
          turn = (score.X+score.O)%2===0 ? 'X' : 'O';
          gameOver = false;
          render();
        };
        // Kapat
        document.getElementById('xox-close-btn').onclick = function() {
          bg.style.display = 'none';
          modal.style.display = 'none';
          document.body.style.overflow = '';
        };
      }
      function checkWinner(b) {
        const lines = [
          [0,1,2],[3,4,5],[6,7,8],
          [0,3,6],[1,4,7],[2,5,8],
          [0,4,8],[2,4,6]
        ];
        for (const [a,b1,c] of lines) {
          if (b[a] && b[a] === b[b1] && b[a] === b[c]) return b[a];
        }
        return null;
      }
      render();
    }
    // --- XOX ODA SİSTEMİ ---
    // XOX lobisine yönlendirme
    function showXOXLobby() {
      document.getElementById('chat-container').style.display = 'none';
      document.getElementById('xox-lobby-container').style.display = 'flex';
      document.getElementById('xox-room-lobby').style.display = 'none';
      loadXOXRoomList();
    }
    // Sohbete dön
    document.addEventListener('DOMContentLoaded', function() {
      const backBtn = document.getElementById('back-to-chat-xox-btn');
      if (backBtn) backBtn.onclick = function() {
        document.getElementById('xox-lobby-container').style.display = 'none';
        document.getElementById('chat-container').style.display = 'flex';
      };
    });
    // XOX oda oluşturma
    const createXOXRoomForm = document.getElementById('create-xox-room-form');
    if (createXOXRoomForm) {
      createXOXRoomForm.onsubmit = function(e) {
        e.preventDefault();
        const roomName = document.getElementById('xox-room-name-input').value.trim();
        if (!roomName) return;
        const user = auth.currentUser;
        if (!user) return alert('Giriş yapmalısınız!');
        const roomRef = db.ref('xoxRooms').push();
        roomRef.set({
          name: roomName,
          owner: user.uid,
          ownerEmail: user.email,
          created: Date.now(),
          players: {
            [user.uid]: {
              email: user.email,
              joined: Date.now(),
              isOwner: true
            }
          },
          started: false
        }).then(() => {
          joinXOXRoom(roomRef.key);
        });
      };
    }
    // XOX oda listesi yükle
    function loadXOXRoomList() {
      const roomListDiv = document.getElementById('xox-room-list');
      roomListDiv.innerHTML = '<div style="color:#ff9800;text-align:center;">Yükleniyor...</div>';
      db.ref('xoxRooms').orderByChild('started').equalTo(false).once('value', function(snapshot) {
        const rooms = snapshot.val() || {};
        let html = '';
        const keys = Object.keys(rooms);
        if (keys.length === 0) {
          html = '<div style="color:#ff9800;text-align:center;">Açık oda yok</div>';
        } else {
          keys.forEach(key => {
            const r = rooms[key];
            html += `<div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:0.5em;background:#232136;padding:0.7em 1em;border-radius:10px;'>
              <span style='font-weight:bold;color:#fff;'>${r.name}</span>
              <button class='auth-btn' style='padding:0.3em 1em;font-size:0.98em;' onclick='joinXOXRoom("${key}")'>Katıl</button>
            </div>`;
          });
        }
        roomListDiv.innerHTML = html;
      });
    }
    // XOX odaları yenile butonu
    const refreshXOXRoomsBtn = document.getElementById('refresh-xox-rooms-btn');
    if (refreshXOXRoomsBtn) refreshXOXRoomsBtn.onclick = loadXOXRoomList;
    // XOX odaya katılma
    window.joinXOXRoom = function(roomId) {
      const user = auth.currentUser;
      if (!user) return alert('Giriş yapmalısınız!');
      const roomRef = db.ref('xoxRooms/' + roomId + '/players/' + user.uid);
      roomRef.set({
        email: user.email,
        joined: Date.now(),
        isOwner: false
      }).then(() => {
        showXOXRoomLobby(roomId);
      });
    };
    // XOX oda lobisi göster
    function showXOXRoomLobby(roomId) {
      document.getElementById('xox-room-lobby').style.display = 'block';
      document.getElementById('xox-room-lobby-title').textContent = 'Oda Lobisi';
      document.getElementById('xox-room-players-list').innerHTML = 'Yükleniyor...';
      const roomRef = db.ref('xoxRooms/' + roomId);
      roomRef.on('value', function(snapshot) {
        const room = snapshot.val();
        if (!room) {
          showCustomModal('Oda bulunamadı veya silindi.');
          document.getElementById('xox-room-lobby').style.display = 'none';
          loadXOXRoomList();
          return;
        }
        // Eğer sadece 1 oyuncu kaldıysa ve oyun başlamışsa, kalan kişiyi at
        const players = room.players || {};
        const playerIds = Object.keys(players);
        if (room.started && playerIds.length === 1) {
          const user = auth.currentUser;
          if (user && players[user.uid]) {
            // Oyun ekranını kapat ve uyarı göster
            const xoxModal = document.getElementById('xox-game-modal');
            if (xoxModal) xoxModal.style.display = 'none';
            showCustomModal('Odadaki tek kişi kaldığınız için oyun sona erdi.');
          }
        }
        // Oyuncu listesi
        let html = '<div style="margin-bottom:0.7em;font-weight:bold;color:#ff9800;">Oyuncular:</div>';
        Object.values(players).forEach((p, i) => {
          html += `<div style='color:#fff;margin-bottom:0.3em;'>${i+1}. ${p.email}${p.isOwner ? ' (Oda Sahibi)' : ''}</div>`;
        });
        document.getElementById('xox-room-players-list').innerHTML = html;
        // Oda sahibi ise "Oyunu Başlat" butonunu göster
        const user = auth.currentUser;
        const isOwner = user && room.owner === user.uid;
        document.getElementById('start-xox-game-btn').style.display = isOwner && !room.started ? 'block' : 'none';
        if (isOwner && !room.started) bindStartXOXGameBtn(roomId);
        // Oyun başladıysa oyun ekranını göster
        if (room.started && room.game) {
          showXOXGameScreen(roomId, room);
        }
      });
      // Odadan çık
      document.getElementById('leave-xox-room-btn').onclick = function() {
        const user = auth.currentUser;
        if (!user) return;
        const playerRef = db.ref('xoxRooms/' + roomId + '/players/' + user.uid);
        playerRef.remove().then(() => {
          // Oda boş mu kontrol et
          db.ref('xoxRooms/' + roomId + '/players').once('value', snap => {
            const players = snap.val();
            if (!players || Object.keys(players).length === 0) {
              // Odayı tamamen sil
              db.ref('xoxRooms/' + roomId).remove();
            }
          });
          document.getElementById('xox-room-lobby').style.display = 'none';
          loadXOXRoomList();
        });
      };
    }
    // XOX oyun başlat
    function startXOXGame(roomId) {
      db.ref('xoxRooms/' + roomId).once('value', function(snapshot) {
        const room = snapshot.val();
        if (!room) return;
        const playerIds = Object.keys(room.players || {});
        if (playerIds.length < 2) return;
        // Oyun durumu
        const gameState = {
          started: true,
          board: Array(9).fill(''),
          turn: playerIds[0],
          winner: null,
          gameOver: false
        };
        db.ref('xoxRooms/' + roomId + '/game').set(gameState);
        db.ref('xoxRooms/' + roomId + '/started').set(true);
      });
    }
    // XOX oyun başlat butonuna bağla
    function bindStartXOXGameBtn(roomId) {
      const btn = document.getElementById('start-xox-game-btn');
      if (btn) {
        btn.onclick = function() {
          startXOXGame(roomId);
        };
      }
    }
    // XOX oyun ekranı
    function showXOXGameScreen(roomId, room) {
      const bg = document.getElementById('xox-game-modal-bg');
      const modal = document.getElementById('xox-game-modal');
      bg.style.display = 'block';
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden';
      const user = auth.currentUser;
      const game = room.game;
      if (!game || !user) return;
      const isMyTurn = game.turn === user.uid;
      // Oyun durumunu gerçek zamanlı dinle
      const gameRef = db.ref('xoxRooms/' + roomId + '/game');
      gameRef.on('value', function(snapshot) {
        const updatedGame = snapshot.val();
        if (updatedGame) {
          render(updatedGame);
        }
      });
      function render(gameState) {
        if (!gameState) return;
        let html = `<div style='background:#232136;padding:2.2em 2.5em;border-radius:18px;box-shadow:0 8px 32px #7c3aed33;min-width:320px;max-width:98vw;text-align:center;animation:modalPopIn 0.5s cubic-bezier(.68,-0.55,.27,1.55);display:flex;flex-direction:column;align-items:center;'>`;
        html += `<div style='font-size:1.3em;font-weight:bold;color:#ff9800;margin-bottom:0.7em;'>X O X (Online)</div>`;
        html += `<div style='margin-bottom:0.7em;font-size:1.1em;color:#fff;'>Sıra: <span style='color:${gameState.turn===user.uid?"#43ea7b":"#ff9800"};font-weight:bold;'>${gameState.turn===user.uid?'Sen':(room.players[gameState.turn]?.email.split('@')[0] || 'Bilinmiyor')}</span></div>`;
        html += `<div id='xox-board' style='display:grid;grid-template-columns:repeat(3,72px);grid-template-rows:repeat(3,72px);gap:12px;margin-bottom:1.2em;'>`;
        for(let i=0;i<9;i++) {
          const cell = gameState.board[i];
          const isMyCell = (i % 2 === 0 && user.uid === Object.keys(room.players)[0]) || (i % 2 === 1 && user.uid === Object.keys(room.players)[1]);
          html += `<button class='xox-cell' data-idx='${i}' style='width:72px;height:72px;font-size:2.2em;font-weight:bold;border-radius:16px;background:#181a1b;color:${cell==='X'?'#43ea7b':cell==='O'?'#ff9800':'#fff'};border:3px solid #7c3aed;box-shadow:0 2px 8px #7c3aed22;transition:background 0.2s, color 0.2s;cursor:${cell||gameState.gameOver?'not-allowed':'pointer'};'>${cell}</button>`;
        }
        html += `</div>`;
        html += `<div id='xox-status' style='min-height:2em;font-size:1.1em;font-weight:bold;color:#ff9800;margin-bottom:1em;'></div>`;
        html += `<div style='display:flex;gap:1.2em;justify-content:center;'>`;
        html += `<button id='xox-close-game-btn' class='uno-game-btn' style='background:#232136;color:#ff9800;border:2px solid #ff9800;'>Sohbete Dön</button>`;
        html += `</div></div>`;
        modal.innerHTML = html;
        // Oyun durumu kontrolü
        const winner = checkXOXWinner(gameState.board);
        const statusDiv = document.getElementById('xox-status');
        if (winner) {
          statusDiv.textContent = `Kazanan: ${winner}`;
          statusDiv.style.color = winner==='X'?'#43ea7b':'#ff9800';
          // Oyun bittikten sonra 3 saniye bekle ve odayı kapat
          setTimeout(() => {
            closeXOXRoomAfterGame(roomId);
          }, 3000);
        } else if (gameState.board.every(cell => cell)) {
          statusDiv.textContent = 'Beraberlik!';
          statusDiv.style.color = '#fff';
          // Beraberlik durumunda da 3 saniye bekle ve odayı kapat
          setTimeout(() => {
            closeXOXRoomAfterGame(roomId);
          }, 3000);
        } else {
          statusDiv.textContent = '';
        }
        // Hücrelere tıklama
        document.querySelectorAll('.xox-cell').forEach(btn => {
          btn.onclick = function() {
            const idx = parseInt(btn.getAttribute('data-idx'));
            if (gameState.board[idx] || gameState.gameOver || gameState.turn !== user.uid) return;
            playXOXMove(roomId, user.uid, idx);
          };
        });
        // Kapat
        document.getElementById('xox-close-game-btn').onclick = function() {
          gameRef.off(); // Firebase dinlemeyi durdur
          bg.style.display = 'none';
          modal.style.display = 'none';
          document.body.style.overflow = '';
        };
      }
      function checkXOXWinner(b) {
        const lines = [
          [0,1,2],[3,4,5],[6,7,8],
          [0,3,6],[1,4,7],[2,5,8],
          [0,4,8],[2,4,6]
        ];
        for (const [a,b1,c] of lines) {
          if (b[a] && b[a] === b[b1] && b[a] === b[c]) return b[a];
        }
        return null;
      }
      render(game);
    }
    // XOX oyunu bittikten sonra odayı kapat
    function closeXOXRoomAfterGame(roomId) {
      // Oyun ekranını kapat
      const bg = document.getElementById('xox-game-modal-bg');
      const modal = document.getElementById('xox-game-modal');
      bg.style.display = 'none';
      modal.style.display = 'none';
      document.body.style.overflow = '';
      
      // Odayı tamamen sil
      db.ref('xoxRooms/' + roomId).remove().then(() => {
        // Lobi ekranını kapat ve oda listesine dön
        document.getElementById('xox-room-lobby').style.display = 'none';
        document.getElementById('xox-lobby-container').style.display = 'flex';
        loadXOXRoomList();
        
        // Oyunculara bilgi ver
        showCustomModal('Oyun bitti! Oda kapatıldı.');
      });
    }
    // XOX hamle oynama
    function playXOXMove(roomId, userId, cellIdx) {
      const roomRef = db.ref('xoxRooms/' + roomId);
      roomRef.transaction(room => {
        if (!room || !room.game || room.game.turn !== userId) return room;
        if (room.game.board[cellIdx] || room.game.gameOver) return room;
        const playerIds = Object.keys(room.players);
        const playerIndex = playerIds.indexOf(userId);
        const symbol = playerIndex === 0 ? 'X' : 'O';
        room.game.board[cellIdx] = symbol;
        const winner = checkXOXWinner(room.game.board);
        if (winner) {
          room.game.winner = winner;
          room.game.gameOver = true;
        } else if (room.game.board.every(cell => cell)) {
          room.game.gameOver = true;
        } else {
          // Sıra geç
          const nextPlayerIndex = (playerIndex + 1) % playerIds.length;
          room.game.turn = playerIds[nextPlayerIndex];
        }
        return room;
      });
    }
    function checkXOXWinner(b) {
      const lines = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (const [a,b1,c] of lines) {
        if (b[a] && b[a] === b[b1] && b[a] === b[c]) return b[a];
      }
      return null;
    }
    // X O X Oyna butonuna tıklayınca XOX lobisine git
    document.addEventListener('DOMContentLoaded', function() {
      if (!document.getElementById('go-to-xo-btn')) {
        const xoBtn = document.createElement('button');
        xoBtn.id = 'go-to-xo-btn';
        xoBtn.textContent = 'X O X Oyna';
        xoBtn.className = 'logout-btn';
        xoBtn.style.marginTop = '0.7em';
        document.querySelector('.chat-card').appendChild(xoBtn);
      }
      const xoBtn = document.getElementById('go-to-xo-btn');
      if (xoBtn) xoBtn.onclick = showXOXLobby;
    });
  </script>
  <script>
    // Özel Chat Butonu ve Modal
    const specialChatBtn = document.getElementById('special-chat-btn');
    const specialChatModalBg = document.getElementById('special-chat-modal-bg');
    const specialChatModal = document.getElementById('special-chat-modal');
    specialChatBtn.onclick = function() {
      specialChatModalBg.style.display = 'block';
      specialChatModal.style.display = 'block';
      specialChatModal.innerHTML = `
        <div style="background:#232136;padding:2.2em 2.5em;border-radius:18px;box-shadow:0 8px 32px #7c3aed33;min-width:320px;max-width:98vw;text-align:center;display:flex;flex-direction:column;align-items:center;">
          <div style='font-size:1.3em;font-weight:bold;color:#ff9800;margin-bottom:0.7em;'>Özel Chat Kodu</div>
          <input id='special-chat-code-input' type='text' maxlength='12' placeholder='Kod girin...' style='font-size:1.2em;padding:0.6em 1em;border-radius:10px;border:1.5px solid #7c3aed;background:#181a1b;color:#fff;margin-bottom:1.2em;width:80%;text-align:center;letter-spacing:0.1em;' autofocus />
          <div style='display:flex;gap:1em;justify-content:center;'>
            <button id='special-chat-ok-btn' style='background:linear-gradient(90deg,#7c3aed 0%,#ff9800 100%);color:#fff;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;'>Onayla</button>
            <button id='special-chat-cancel-btn' style='background:#23272b;color:#ff9800;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;'>Kapat</button>
          </div>
        </div>
      `;
      document.getElementById('special-chat-code-input').focus();
      document.getElementById('special-chat-cancel-btn').onclick = closeSpecialChatModal;
      specialChatModalBg.onclick = closeSpecialChatModal;
      document.getElementById('special-chat-ok-btn').onclick = function() {
        const code = document.getElementById('special-chat-code-input').value.trim();
        if (!code) {
          alert('Lütfen bir kod girin!');
          return;
        }
        closeSpecialChatModal();
        openPrivateChatModal(code);
      };
    };
    function closeSpecialChatModal() {
      specialChatModalBg.style.display = 'none';
      specialChatModal.style.display = 'none';
    }
  </script>
  <script>
    // Özel chat koduna özel chat modalı
    function openPrivateChatModal(code) {
      // Modal arka planı
      let bg = document.getElementById('private-chat-modal-bg');
      let modal = document.getElementById('private-chat-modal');
      if (!bg) {
        bg = document.createElement('div');
        bg.id = 'private-chat-modal-bg';
        bg.style = 'display:block;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,27,0.85);z-index:3000;';
        document.body.appendChild(bg);
      } else {
        bg.style.display = 'block';
      }
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'private-chat-modal';
        modal.style = 'display:block;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:3001;min-width:320px;max-width:98vw;';
        document.body.appendChild(modal);
      } else {
        modal.style.display = 'block';
      }
      document.body.style.overflow = 'hidden';
      // Modal içeriği
      modal.innerHTML = `
        <div style="background:#232136;padding:2.2em 2.5em;border-radius:18px;box-shadow:0 8px 32px #7c3aed33;min-width:320px;max-width:98vw;text-align:center;display:flex;flex-direction:column;align-items:center;">
          <div style='font-size:1.2em;font-weight:bold;color:#ff9800;margin-bottom:0.7em;'>Özel Chat - Kod: <span style='color:#43ea7b;'>${code}</span></div>
          <div id='private-chat-messages' style='width:100%;height:220px;max-height:220px;overflow-y:auto;background:#181a1b;border-radius:10px;padding:1em 0.7em;margin-bottom:1em;color:#fff;text-align:left;font-size:1.05em;box-shadow:0 2px 8px #7c3aed22;'></div>
          <form id='private-chat-form' style='display:flex;gap:0.5em;width:100%;'>
            <input id='private-chat-input' type='text' maxlength='300' placeholder='Mesajınızı yazın...' required style='flex:1;border-radius:10px;border:1.5px solid #7c3aed;background:#181a1b;color:#fff;padding:0.6em 1em;font-size:1.08rem;outline:none;'/>
            <button type='submit' style='background:linear-gradient(90deg,#7c3aed 0%,#ff9800 100%);color:#fff;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;'>Gönder</button>
          </form>
          <button id='private-chat-close-btn' style='margin-top:1em;background:#23272b;color:#ff9800;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;'>Kapat</button>
        </div>
      `;
      // Kapatma
      document.getElementById('private-chat-close-btn').onclick = function() {
        bg.style.display = 'none';
        modal.style.display = 'none';
        document.body.style.overflow = '';
        if (window.privateChatListener) window.privateChatListener.off();
      };
      bg.onclick = function(e) {
        if (e.target === bg) {
          bg.style.display = 'none';
          modal.style.display = 'none';
          document.body.style.overflow = '';
          if (window.privateChatListener) window.privateChatListener.off();
        }
      };
      // Mesaj gönderme
      const privateChatForm = document.getElementById('private-chat-form');
      const privateChatInput = document.getElementById('private-chat-input');
      const privateChatMessages = document.getElementById('private-chat-messages');
      let username = localStorage.getItem('chat-username') || 'Kullanıcı';
      privateChatForm.onsubmit = function(e) {
        e.preventDefault();
        const text = privateChatInput.value.trim();
        if (!text) return;
        firebase.database().ref('privateChats/' + code).push({
          user: username,
          text: text,
          time: Date.now()
        });
        privateChatInput.value = '';
      };
      // Mesajları dinle
      if (window.privateChatListener) window.privateChatListener.off();
      window.privateChatListener = firebase.database().ref('privateChats/' + code);
      window.privateChatListener.limitToLast(50).on('child_added', function(snapshot) {
        const msg = snapshot.val();
        const msgDiv = document.createElement('div');
        msgDiv.innerHTML = `<span style='color:#ff9800;font-weight:bold;'>${msg.user}:</span> <span style='color:#fff;'>${msg.text}</span>`;
        privateChatMessages.appendChild(msgDiv);
        privateChatMessages.scrollTop = privateChatMessages.scrollHeight;
      });
    }
  </script>
  <!-- Sayfa sonu footer -->
  <footer style="width:100vw;text-align:center;padding:1.2em 0 1.2em 0;background:#232136;color:#fff;font-size:1em;letter-spacing:1px;opacity:0.85;margin-top:2em;">
    © 2024 Top-Secret | Güvenli Sohbet ve Oyun Platformu
    · <a href="#" id="about-link" style="color:#ff9800;text-decoration:underline;">Hakkında</a>
    · <a href="#" id="terms-link" style="color:#ff9800;text-decoration:underline;">Kullanım Koşulları</a>
    · <a href="#" id="shortcuts-link" style="color:#43ea7b;text-decoration:underline;">Kısayollar</a>
  </footer>
  <script>
    // Tema değiştirme
    const themeBtn = document.getElementById('theme-toggle-btn');
    let darkMode = true;
    themeBtn.onclick = function() {
      darkMode = !darkMode;
      document.body.style.background = darkMode ? '#181a1b' : '#f5f5f7';
      document.body.style.color = darkMode ? '#f5f5f7' : '#232136';
      themeBtn.textContent = darkMode ? '🌙' : '☀️';
      showToast(darkMode ? 'Karanlık mod aktif' : 'Açık mod aktif');
    };
    // Dil değiştirme
    const langBtn = document.getElementById('lang-toggle-btn');
    let lang = 'TR';
    langBtn.onclick = function() {
      lang = lang === 'TR' ? 'EN' : 'TR';
      langBtn.textContent = lang === 'TR' ? 'EN' : 'TR';
      showToast(lang === 'TR' ? 'Dil: Türkçe' : 'Language: English');
      // Burada arayüz metinlerini değiştirebilirsin (örnek olarak toast gösteriliyor)
    };
    // Yukarı çık butonu
    const scrollBtn = document.getElementById('scroll-top-btn');
    window.onscroll = function() {
      scrollBtn.style.display = window.scrollY > 200 ? 'flex' : 'none';
    };
    scrollBtn.onclick = function() {
      window.scrollTo({top:0,behavior:'smooth'});
    };
    // Hakkında ve kullanım koşulları modalı
    const aboutLink = document.getElementById('about-link');
    const termsLink = document.getElementById('terms-link');
    const aboutModalBg = document.getElementById('about-modal-bg');
    const aboutModal = document.getElementById('about-modal');
    aboutLink.onclick = function(e){e.preventDefault();aboutModalBg.style.display='block';aboutModal.style.display='block';aboutModal.innerHTML='<h2>Hakkında</h2><p>Top-Secret, güvenli ve modern bir sohbet, özel chat ve oyun platformudur. Tüm verileriniz gizli tutulur.</p><button onclick="closeAboutModal()" style="margin-top:1em;background:#23272b;color:#ff9800;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;">Kapat</button>';};
    termsLink.onclick = function(e){e.preventDefault();aboutModalBg.style.display='block';aboutModal.style.display='block';aboutModal.innerHTML='<h2>Kullanım Koşulları</h2><p>Bu siteyi kullanarak gizlilik ve güvenlik kurallarını kabul etmiş olursunuz. Kötüye kullanım tespit edilirse erişim engellenebilir.</p><button onclick="closeAboutModal()" style="margin-top:1em;background:#23272b;color:#ff9800;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;">Kapat</button>';};
    aboutModalBg.onclick = closeAboutModal;
    function closeAboutModal(){aboutModalBg.style.display='none';aboutModal.style.display='none';}
    // Kısayollar modalı
    const shortcutsLink = document.getElementById('shortcuts-link');
    const shortcutsModalBg = document.getElementById('shortcuts-modal-bg');
    const shortcutsModal = document.getElementById('shortcuts-modal');
    shortcutsLink.onclick = function(e){e.preventDefault();shortcutsModalBg.style.display='block';shortcutsModal.style.display='block';shortcutsModal.innerHTML='<h2>Klavye Kısayolları</h2><ul style="text-align:left;max-width:320px;margin:0 auto 1em auto;"><li><b>Enter</b>: Mesaj gönder</li><li><b>ESC</b>: Modal kapat</li><li><b>Ctrl+K</b>: Arama (varsa)</li></ul><button onclick="closeShortcutsModal()" style="margin-top:1em;background:#23272b;color:#ff9800;font-weight:bold;border:none;border-radius:10px;padding:0.6em 1.2em;cursor:pointer;">Kapat</button>';};
    shortcutsModalBg.onclick = closeShortcutsModal;
    function closeShortcutsModal(){shortcutsModalBg.style.display='none';shortcutsModal.style.display='none';}
    // Hoşgeldin mesajı (giriş yapan kullanıcıya)
    function showWelcomeMsg(){
      const user = firebase.auth().currentUser;
      const msgDiv = document.getElementById('welcome-msg');
      if(user && user.email){
        msgDiv.textContent = 'Hoşgeldin, ' + (user.email.split('@')[0]) + '!';
        msgDiv.style.display = 'block';
      }else{
        msgDiv.style.display = 'none';
      }
    }
    firebase.auth().onAuthStateChanged(showWelcomeMsg);
    // Toast bildirim sistemi
    function showToast(msg){
      const toastC = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.textContent = msg;
      toast.style = 'background:#232136;color:#ff9800;padding:0.8em 1.4em;border-radius:10px;box-shadow:0 2px 8px #7c3aed33;font-weight:bold;font-size:1.08em;opacity:0.97;';
      toastC.appendChild(toast);
      setTimeout(()=>{toast.style.opacity='0.2';},1800);
      setTimeout(()=>{toast.remove();},2400);
    }
    // Loading spinner göster/gizle fonksiyonu
    function showLoadingSpinner(show){
      document.getElementById('loading-spinner').style.display = show ? 'flex' : 'none';
    }
    // ESC ile modal kapama
    document.addEventListener('keydown',function(e){
      if(e.key==='Escape'){
        closeAboutModal();
        closeShortcutsModal();
      }
    });
  </script>
</body>
</html> 
